<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <link rel="stylesheet" href="text/css" href="js/angular-material/angular-material.css"/>
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <title>Hello World</title>
</head>
<body>

<div ng-controller="MainController as vm">
    <!--INSERT INFORMATION HERE FOR THE MAIN CONTROLLER-->
    <md-button class="md-raised md-primary" ng-click="vm.getLights()">Get lights</md-button>
    <md-button class="md-raised md-primary" ng-click="vm.setLight()">Set Lights</md-button>
    <md-button class="md-raised md-primary" ng-click="vm.createUser()">Create user</md-button>
</div>

<!--<md-button class="md-raised md-primary" onclick="oauth2_login()">LOG IN</md-button>-->
<!--<button id="authorize-button" style="visibility: hidden">Authorize</button>-->
<div class="content">
    <h1>Oauth2</h1>
    <p><div class="button" onclick="oauth2_login()">Oauth2 Login</div></p>
    <div id="logs"></div>
</div>

    <h1>Apache Cordova</h1>
    <div id="deviceready">
        <p class="event listening">Connecting to Device</p>
        <p class="event received">Device is Ready</p>
    </div>

<!--CORDOVA-->
<script type="text/javascript" src="cordova.js"></script>
<!--JQUERY-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<!--HUE DEPENDENCY-->
<script src="js/jshue.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<!--CORDOVA OAUTH2-->
<script src="js/cordova.oauth2.js"></script>
<!--GOOGLE API-->
<!--<script src="https://apis.google.com/js/client.js"></script>

<!--SCRIPT AUTH-->
<script>

    //script src="https://apis.google.com/js/client.js?onload=OnLoadCallback"
    // template for new oauth2 service
    function oauth2_login() {
        $.oauth2({
            auth_url: 'https://accounts.google.com/o/oauth2/auth',           // required
            response_type: 'code',      // required - "code"/"token"
            token_url: 'https://accounts.google.com/o/oauth2/token',          // required if response_type = 'code'
            logout_url: 'https://accounts.google.com/logout',         // recommended if available
            client_id: '435124131375-571j8bianm4e2rlp5ib5qicj3p54l0hm.apps.googleusercontent.com',          // required
            client_secret: 'ozILwWwXLpmNsgB1yCBiqgPU',      // required if response_type = 'code'
            redirect_uri: 'http://localhost/oauth2callback',       // required - some dummy url
            other_params: {
                'scope': 'https://www.googleapis.com/auth/calendar'
            }        // optional params object for scope, state, display...
        }, on_success, function(error, response){

            // do something with error object
            $("#logs").append("<p class='error'><b>error: </b>"+JSON.stringify(error)+"</p>");
            $("#logs").append("<p class='error'><b>response: </b>"+JSON.stringify(response)+"</p>");
        });

    }
    function on_success(token, response){
        // do something with token or response
        //var authorizeButton = document.getElementById('authorize-button');
        //authorizeButton.style.visibility = '';
        $.get('https://www.googleapis.com/calendar/v3/calendars/testfornith@gmail.com/events?'+'access_token='+token, ev_handler);

        function ev_handler(data){

            var number_of_current_events=0;
            var today = new Date();
            for(var i=0;i<data.items.length;i++){

                var eventStartDate = new Date(data.items[i].start.dateTime);
                var eventEndDate = new Date(data.items[i].end.dateTime);


                if (+today >= +eventStartDate.valueOf() && +today <= +eventEndDate.valueOf()) {

                    $("#logs").append("<p class='success'><b>All the events with token: </b>"+JSON.stringify(data.items[i].summary)+"</p>");
                    number_of_current_events+=1;
                }
            }
            if (number_of_current_events==0){
                $("#logs").append("<p class='success'><b>All the events with token: </b>"+JSON.stringify('No current events')+"</p>");
            }
        }



        //console
        //$("#logs").append("<p class='success'><b>access_token: </b>"+token+"</p>");
        //$("#logs").append("<p class='success'><b>response: </b>"+JSON.stringify(response)+"</p>");
    }

</script>
<!--SCRIPT AUTH END-->
<!--FRAMEWORKS-->
<script src="js/angular/angular.js"></script>
<script src="js/angular-animate/angular-animate.js"></script>
<script src="js/angular-aria/angular-aria.js"></script>
<script src="js/angular-material/angular-material.js"></script>
<!--MODULES-->
<script src="js/app.js"></script>
<!--CONTROLLERS-->
<script src="js/mainController.js"></script>

</body>
</html>
